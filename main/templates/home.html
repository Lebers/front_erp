<!-- home.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Home</title>
  <link rel="stylesheet" href="{% static 'main/vendors/typicons.font/font/typicons.css' %}">
  <link rel="stylesheet" href="{% static 'main/vendors/css/vendor.bundle.base.css' %}">
  <link rel="stylesheet" href="{% static 'main/vendors/select2/select2.min.css' %}">
  <link rel="stylesheet" href="{% static 'main/vendors/select2-bootstrap-theme/select2-bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'main/css/vertical-layout-light/style.css' %}">
  <link rel="shortcut icon" href="{% static 'main/images/favicon.png' %}" />

  <style>
    #fullsize-iframe {
    width: 100%;
    height: calc(100vh - 69px);
    border: none; /* Opcional: elimina el borde del iframe */
}
  </style>
 
</head>

<body>
    
  <div class="container-scroller">
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
          <a class="navbar-brand brand-logo" href="home"><img src="{% static 'main/images/logo.png' %}" alt="logo"/></a>
          <a class="navbar-brand brand-logo-mini" href="home"><img src="{% static 'main/images/logo-mini.svg' %}" alt="logo"/></a>
          <button class="navbar-toggler navbar-toggler align-self-center d-none d-lg-flex" type="button" data-toggle="minimize">
            <span class="typcn typcn-th-menu"></span>
          </button>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
          <ul class="navbar-nav navbar-nav-right">
             
            <li class="nav-item dropdown  d-flex">
              <a class="nav-link count-indicator dropdown-toggle d-flex align-items-center justify-content-center" id="notificationDropdown" href="#" data-toggle="dropdown">
                <i class="typcn typcn-bell mr-0"></i>
                <span class="count bg-danger">2</span>
              </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                <p class="mb-0 font-weight-normal float-left dropdown-header">Notifications</p>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-success">
                      <i class="typcn typcn-info-large mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal">Application Error</h6>
                    <p class="font-weight-light small-text mb-0">
                      Just now
                    </p>
                  </div>
                </a>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-warning">
                      <i class="typcn typcn-cog mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal">Settings</h6>
                    <p class="font-weight-light small-text mb-0">
                      Private message
                    </p>
                  </div>
                </a>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-info">
                      <i class="typcn typcn-user-outline mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal">New user registration</h6>
                    <p class="font-weight-light small-text mb-0">
                      2 days ago
                    </p>
                  </div>
                </a>
              </div>
            </li>
            <li class="nav-item nav-profile dropdown">
              <a class="nav-link dropdown-toggle  pl-0 pr-0" href="#" data-toggle="dropdown" id="profileDropdown">
                <i class="typcn typcn-user-outline mr-0"></i>
                
              </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
                <a class="dropdown-item">
                    <i class="typcn typcn-cog text-primary"></i>
                    Settings
                </a>
                <a class="dropdown-item">
                    <i class="typcn typcn-power text-primary"></i>
                    <span>
                        <form action="{% url 'logout' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn text-primary" style="background:none; border:none; padding:0;">Cerrar Sesión</button>
                        </form>
                    </span>
                </a>
              </div>
            </li>
          </ul>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
            <span class="typcn typcn-th-menu"></span>
          </button>
        </div>
      </nav>
 
    <div class="container-fluid page-body-wrapper">
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">          
           
        </ul>
        </nav>
      
      <!-- partial -->
      <div class="main-panel">        
        <div class="content-wrapper" style="padding-top: 5px; padding-left: 20px;">
          <div class="row">
            <iframe id="fullsize-iframe" src="inicio/">     Tu navegador no soporta iframes.   </iframe>
          </div>
        </div>
         
      </div>
    </div>
  </div>


  <script src="{% static 'main/vendors/js/vendor.bundle.base.js' %}"></script>
  <script src="{% static 'main/js/off-canvas.js' %}"></script>
  <script src="{% static 'main/js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'main/js/template.js' %}"></script>
  <script src="{% static 'main/js/settings.js' %}"></script>
  <script src="{% static 'main/js/todolist.js' %}"></script>
  <script src="{% static 'main/vendors/select2/select2.min.js' %}"></script>
  <script src="{% static 'main/js/file-upload.js' %}"></script>
  <script src="{% static 'main/js/select2.js' %}"></script>
  <script>
    function loadInFrame(url) {
      $('#fullsize-iframe').attr('src', url);
      toggleMenu();
    }

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
    }

    $(document).ready(function() {
        $.ajax({
            url: '/api_proxy/',
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify({ "api_method": "menu_me","type_method":"GET" }),
            success: function(data) {
               console.log("data",data);
               var firstUrl = null;
                var menu_items = data.data;
                var menu_html = '<li class="nav-item">';
                    menu_html += '<div class="d-flex sidebar-profile">';
                        menu_html += '<div class="sidebar-profile-image">';
                            menu_html += '<img src="/static/main/images/faces/face29.png" alt="image">';

                            menu_html += '<span class="sidebar-status-indicator"></span>';
                            menu_html += '</div>';
                            menu_html += '<div class="sidebar-profile-name">';
                                menu_html += '<p class="sidebar-name">';
                                    menu_html += '{Usuario}';
                                    menu_html += '</p>';
                                    menu_html += '<p class="sidebar-designation">';
                                        menu_html += '  Online';
                                        menu_html += ' </p>';
                                        menu_html += ' </div>';
                                        menu_html += ' </div>';
           
                                        menu_html += '</li>';
                menu_items.forEach(function(item) {
                    console.log("item",item);
                    menu_html += '<li class="nav-item">';
                    if(item.children){
                        // Si el elemento del menú tiene subelementos, construye un menú desplegable
                        menu_html += '<a class="nav-link" data-toggle="collapse" href="#' + item.title.replace(/\s+/g, '-').toLowerCase() + '" aria-expanded="false" aria-controls="' + item.title.replace(/\s+/g, '-').toLowerCase() + '">';
                        menu_html += '<i class="menu-icon typcn ' + item.icon + '"></i>';
                        menu_html += '<span class="menu-title">' + item.title + '</span>';
                        menu_html += '<i class="menu-arrow"></i></a>';
                        menu_html += '<div class="collapse" id="' + item.title.replace(/\s+/g, '-').toLowerCase() + '">';
                        menu_html += '<ul class="nav flex-column sub-menu">';
                        item.children.forEach(function(subitem){
                            if (!firstUrl) firstUrl = subitem.link; 
                            menu_html += '<li class="nav-item"> <a class="nav-link" href="#" onclick="event.preventDefault(); loadInFrame(\'' + subitem.link + '\');">' + subitem.title + '</a></li>';
                        });
                        menu_html += '</ul></div>';
                    } else {
                        if (!firstUrl) firstUrl = item.link;
                        menu_html += '<a class="nav-link" href="#" onclick="event.preventDefault(); loadInFrame(\'' + item.link + '\');">';
                        menu_html += '<i class="menu-icon typcn ' + item.icon + '"></i>';
                        menu_html += '<span class="menu-title">' + item.title + '</span></a>';
                    }
                    menu_html += '</li>';
                });
                $('#sidebar .nav').html(menu_html);
                if (firstUrl) {
                  loadInFrame(firstUrl);
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    });

    </script>
</body>

</html>
